# STM32遥控车

项目使用了HAL库，所以可以很方便的移植。

## 硬件环境
- 开发板芯片：STM32F103VCT6
- 遥控芯片： 蓝牙HC-05
- 电机： 4个**步进电机**~~（坑死人了）~~
- 电机驱动： 每个轮子输入1路PWM信号，1路方向信号

## 软件环境
- 配置生成：STM32CubeMX
- 代码编写：Jetbrains CLion
- 调试：ST-Link V2, Keil μVision5

## 项目结构
- Core： STM32CubeMX生成的代码，也是需要完成的代码。
- MDK-ARM： MDK-ARM工程文件

## 针脚分配
- 电机驱动：TIM3_CH3(PB0), TIM4_CH1(PD12), TIM4_CH2(PD13), TIM4_CH3(PD14)
- 电机方向控制：PE7, PE9, PE11, PE13
- 与蓝牙模块通讯（也可以换成Wifi模块或上位机）：UART4, Baud rate 9600: TX(PC10), RX(PC11)
启用了DMA

## 指令格式
使用HEX发送，最大长度为17个字节(`usart.h`中指定的`rx_data_length`)，第0字节为指令前缀，第1-4字节每个字节代表一个轮子的方向，第5-16字节表示速度。

命令前缀：
- `M`：持续移动(Move)；
- `S`：步进(Step，走一步就停)，使用了DMA；
- `H`：停止(Halt，默认状态)；
- `E`：回传(Echo)；
- `R`：重启(Reset)；
- `P`：已打包的命令(Packaged)

### `M`指令——持续移动

正反转：0：正转；1：反转
> ⚠ 注意，轮子的正反转是相对电机的，不是相对于整车的

PWM范围：000-449
数值越大转的越快

#### 例：
发送`M 0 0 1 1 449 449 449 449`(无空格)，
意为`持续移动命令 1号轮子正转, 2号轮子正转, 3号轮子反转, 4号轮子反转, 速度449，速度449，速度449，速度449`，

### `S`指令——走一步就停

正反转：0：正转；1：反转

移动距离：000-449

#### 例：
发送`S0000449449449449`(无空格)，
意为`步进命令 1号轮子正转, 2号轮子正转, 3号轮子反转, 4号轮子正转, 速度449，速度449，速度449，速度449`，

### `E`指令
发送`E`(无空格)，
意为`回复消息`，会回复接收缓冲区的后16字节(rx_data + 1)。

### `R`指令
发送`R`(无空格)，
意为`重启`，会重启单片机。

### `H`指令
发送`H`(无空格)，
意为`停止`，会停止所有电机。

### `P`指令
注意，`P`指令需要根据不同的小车进行更改
- `PQ` 向前移动
- `PH` 向后移动
- `PZ` 原地逆时针旋转
- `PY` 原地顺时针旋转
- `PL` 向左前方行驶
- `PR` 向右前方行驶
